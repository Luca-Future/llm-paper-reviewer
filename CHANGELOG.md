# 更新日志

本文档记录了 Paper Reviewer AI 的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
本项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [2.0.0] - 2024-01-17

### 新增 (Added)

- **完整架构重构**：采用现代分层架构设计
- **依赖注入容器**：实现松耦合的服务管理
- **模块化CLI界面**：基于 Click 的完整命令行界面
- **批量处理功能**：支持目录批量分析和并发控制
- **多AI服务支持**：支持 OpenAI 和 DeepSeek 等多种AI服务
- **配置管理系统**：支持环境变量和 YAML 文件配置
- **领域驱动设计**：清晰的领域模型和业务逻辑分离
- **适配器模式**：统一的外部服务接口
- **异步处理**：全面支持异步操作提高性能
- **错误恢复机制**：智能的错误处理和重试逻辑
- **结构化日志**：统一的日志记录和监控
- **分析质量评估**：自动计算分析质量得分
- **函数调用支持**：使用 OpenAI 函数调用确保输出一致性

### 改进 (Improved)

- **代码质量**：完整的类型提示和文档字符串
- **测试覆盖**：单元测试、集成测试和端到端测试
- **错误处理**：更友好的错误信息和恢复机制
- **性能优化**：异步处理和并发控制
- **内存管理**：更好的资源使用和清理
- **配置灵活性**：支持多种配置方式和运行时参数
- **可扩展性**：插件化的架构设计

### 修复 (Fixed)

- **JSON输出一致性**：使用函数调用确保输出格式稳定
- **内存泄漏**：修复资源未正确释放的问题
- **并发问题**：解决批量处理的并发安全问题
- **配置加载**：修复环境变量和YAML配置的冲突问题
- **错误恢复**：改进AI服务失败的恢复机制

### 移除 (Removed)

- **单文件架构**：移除旧的单一文件实现
- **硬编码配置**：移除代码中的硬编码配置
- **同步处理**：移除所有同步操作，改为异步
- **旧版CLI**：移除基于 argparse 的旧CLI实现
- **直接依赖**：减少对外部库的直接依赖

### 安全 (Security)

- **API密钥管理**：更安全的密钥存储和处理
- **输入验证**：增强文件路径和内容验证
- **错误信息**：避免在错误信息中泄露敏感信息
- **权限控制**：改进文件访问权限检查

### 迁移指南

从 v1.0.0 升级到 v2.0.0 需要以下更改：

1. **更新命令使用方式**：
   ```bash
   # 旧版本
   python paper_analyzer.py paper.pdf

   # 新版本
   python -m interfaces.cli.main analyze paper.pdf
   ```

2. **配置文件更新**：
   ```bash
   # 添加新的环境变量
   AI_PROVIDER=openai
   PROMPT_VERSION=EN_2_0
   ```

3. **代码依赖更新**：
   ```python
   # 使用新的依赖注入系统
   from infrastructure.container import get_container
   container = get_container()
   ```

## [1.0.0] - 2024-01-15

### 新增 (Added)

- **基础PDF解析**：支持PDF文件转Markdown
- **AI分析功能**：使用OpenAI进行论文分析
- **多语言支持**：中英文分析能力
- **提示词系统**：可配置的分析提示词
- **图片提取**：PDF中图片的提取和嵌入
- **页眉页脚移除**：智能的文本清理功能
- **CLI界面**：基础的命令行操作

### 改进 (Improved)

- **文本质量**：改进PDF文本提取质量
- **分析准确性**：优化提示词和分析逻辑
- **错误处理**：基础的错误处理机制

### 限制 (Limitations)

- **单文件架构**：所有功能集中在单个文件中
- **同步处理**：不支持异步操作
- **有限配置**：配置选项较少
- **无批量处理**：只能处理单个文件
- **硬编码依赖**：直接依赖外部库

---

## 版本说明

### 版本号规则

- **主版本号**：不兼容的API更改
- **次版本号**：向下兼容的功能新增
- **修订号**：向下兼容的问题修复

### 支持周期

- **当前版本 (2.x)**：活跃维护和功能开发
- **前一版本 (1.x)**：仅安全修复，不再开发新功能

### 升级建议

- 生产环境建议使用最新的稳定版本
- 升级前请仔细阅读迁移指南
- 重大版本升级前建议进行充分测试